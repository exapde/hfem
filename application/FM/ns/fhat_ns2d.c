void fhat_ns2d(double *fh, double *fh_udg, double *fh_uh, double *pg, double *udg, double *uh, double *nl, double *param, double time, int ng, int nc, int ncu, int nd, int ncd)
{
	double param1 = param[0];
	double param2 = param[1];
	double param3 = param[2];
	double param4 = param[3];
	double param5 = param[4];
	double param6 = param[5];

	for (int i = 0; i <ng; i++) {
		double x1 = pg[0*ng+i];
		double x2 = pg[1*ng+i];
		double u1 = udg[0*ng+i];
		double u2 = udg[1*ng+i];
		double u3 = udg[2*ng+i];
		double u4 = udg[3*ng+i];
		double u5 = udg[4*ng+i];
		double u6 = udg[5*ng+i];
		double u7 = udg[6*ng+i];
		double u8 = udg[7*ng+i];
		double u9 = udg[8*ng+i];
		double u10 = udg[9*ng+i];
		double u11 = udg[10*ng+i];
		double u12 = udg[11*ng+i];
		double uh1 = uh[0*ng+i];
		double uh2 = uh[1*ng+i];
		double uh3 = uh[2*ng+i];
		double uh4 = uh[3*ng+i];
		double nl1 = nl[0*ng+i];
		double nl2 = nl[1*ng+i];

		double t2 = 1.0/uh1;
		double t3 = uh2*uh2;
		double t4 = 1.0/param3;
		double t5 = 1.0/(uh1*uh1);
		double t6 = uh3*uh3;
		double t7 = param1-1.0;
		double t8 = t3+t6-uh1*uh4*2.0;
		double t9 = t2*t7*t8*(1.0/2.0);
		double t10 = u7*uh1;
		double t11 = u10*uh1;
		double t12 = param3*uh1*uh2*uh3;
		double t13 = t10+t11+t12-u5*uh3-u9*uh2;
		double t14 = uh1*uh1;
		fh[0*ng+i] = nl1*uh2+nl2*uh3+param6*(u1-uh1);
		fh[1*ng+i] = param6*(u2-uh2)-nl1*(t9-t2*t3+t4*t5*(u5*uh2*4.0-u6*uh1*4.0-u9*uh3*2.0+u11*uh1*2.0)*(1.0/3.0))+nl2*t4*t5*t13;
		fh[2*ng+i] = nl2*(-t9+t2*t6+t4*t5*(u5*uh2*2.0-u6*uh1*2.0-u9*uh3*4.0+u11*uh1*4.0)*(1.0/3.0))+param6*(u3-uh3)+nl1*t4*t5*t13;
		fh[3*ng+i] = (t4*1.0/(uh1*uh1*uh1)*(nl1*param1*t3*u5*6.0+nl1*param1*t6*u5*6.0-nl1*param4*t3*u5*8.0+nl2*param1*t3*u9*6.0-nl1*param4*t6*u5*6.0+nl2*param1*t6*u9*6.0-nl2*param4*t3*u9*6.0-nl2*param4*t6*u9*8.0+nl1*param1*t14*u8*6.0+nl2*param1*t14*u12*6.0-nl1*param1*u6*uh1*uh2*6.0-nl1*param1*u5*uh1*uh4*6.0-nl1*param1*u7*uh1*uh3*6.0+nl1*param4*u6*uh1*uh2*8.0+nl1*param4*u7*uh1*uh3*6.0-nl2*param1*u10*uh1*uh2*6.0-nl2*param4*u5*uh2*uh3*2.0-nl2*param4*u6*uh1*uh3*4.0+nl2*param4*u7*uh1*uh2*6.0-nl2*param1*u9*uh1*uh4*6.0-nl2*param1*u11*uh1*uh3*6.0-nl1*param4*u9*uh2*uh3*2.0+nl1*param4*u10*uh1*uh3*6.0-nl1*param4*u11*uh1*uh2*4.0+nl2*param4*u10*uh1*uh2*6.0+nl2*param4*u11*uh1*uh3*8.0+nl1*param3*param4*t3*uh1*uh2*3.0+nl2*param3*param4*t3*uh1*uh3*3.0+nl1*param3*param4*t6*uh1*uh2*3.0+nl2*param3*param4*t6*uh1*uh3*3.0+param3*param4*param6*t14*u4*uh1*6.0-param3*param4*param6*t14*uh1*uh4*6.0-nl1*param1*param3*param4*t3*uh1*uh2*3.0-nl2*param1*param3*param4*t3*uh1*uh3*3.0-nl1*param1*param3*param4*t6*uh1*uh2*3.0-nl2*param1*param3*param4*t6*uh1*uh3*3.0+nl1*param1*param3*param4*t14*uh2*uh4*6.0+nl2*param1*param3*param4*t14*uh3*uh4*6.0)*(1.0/6.0))/param4;

	}

	for (int i = 0; i <ng; i++) {
		double x1 = pg[0*ng+i];
		double x2 = pg[1*ng+i];
		double u1 = udg[0*ng+i];
		double u2 = udg[1*ng+i];
		double u3 = udg[2*ng+i];
		double u4 = udg[3*ng+i];
		double u5 = udg[4*ng+i];
		double u6 = udg[5*ng+i];
		double u7 = udg[6*ng+i];
		double u8 = udg[7*ng+i];
		double u9 = udg[8*ng+i];
		double u10 = udg[9*ng+i];
		double u11 = udg[10*ng+i];
		double u12 = udg[11*ng+i];
		double uh1 = uh[0*ng+i];
		double uh2 = uh[1*ng+i];
		double uh3 = uh[2*ng+i];
		double uh4 = uh[3*ng+i];
		double nl1 = nl[0*ng+i];
		double nl2 = nl[1*ng+i];

		double t2 = 1.0/param3;
		double t3 = 1.0/(uh1*uh1);
		double t4 = uh2*uh2;
		double t5 = uh3*uh3;
		double t6 = 1.0/uh1;
		double t7 = 1.0/param4;
		double t8 = 1.0/(uh1*uh1*uh1);
		double t9 = nl2*t2*t6;
		double t10 = nl1*t2*t6;
		double t11 = nl1*param4*uh1*uh3*6.0;
		double t12 = nl2*param4*uh1*uh2*6.0;
		fh_udg[0*ng+i] = param6;
		fh_udg[1*ng+i] = 0.0;
		fh_udg[2*ng+i] = 0.0;
		fh_udg[3*ng+i] = 0.0;
		fh_udg[4*ng+i] = 0.0;
		fh_udg[5*ng+i] = param6;
		fh_udg[6*ng+i] = 0.0;
		fh_udg[7*ng+i] = 0.0;
		fh_udg[8*ng+i] = 0.0;
		fh_udg[9*ng+i] = 0.0;
		fh_udg[10*ng+i] = param6;
		fh_udg[11*ng+i] = 0.0;
		fh_udg[12*ng+i] = 0.0;
		fh_udg[13*ng+i] = 0.0;
		fh_udg[14*ng+i] = 0.0;
		fh_udg[15*ng+i] = param6;
		fh_udg[16*ng+i] = 0.0;
		fh_udg[17*ng+i] = nl1*t2*t3*uh2*(-4.0/3.0)-nl2*t2*t3*uh3;
		fh_udg[18*ng+i] = -nl1*t2*t3*uh3+nl2*t2*t3*uh2*(2.0/3.0);
		fh_udg[19*ng+i] = t2*t7*t8*(nl1*param1*t4*-6.0-nl1*param1*t5*6.0+nl1*param4*t4*8.0+nl1*param4*t5*6.0+nl1*param1*uh1*uh4*6.0+nl2*param4*uh2*uh3*2.0)*(-1.0/6.0);
		fh_udg[20*ng+i] = 0.0;
		fh_udg[21*ng+i] = nl1*t2*t6*(4.0/3.0);
		fh_udg[22*ng+i] = nl2*t2*t6*(-2.0/3.0);
		fh_udg[23*ng+i] = t2*t7*t8*(nl1*param1*uh1*uh2*6.0-nl1*param4*uh1*uh2*8.0+nl2*param4*uh1*uh3*4.0)*(-1.0/6.0);
		fh_udg[24*ng+i] = 0.0;
		fh_udg[25*ng+i] = t9;
		fh_udg[26*ng+i] = t10;
		fh_udg[27*ng+i] = t2*t7*t8*(t11+t12-nl1*param1*uh1*uh3*6.0)*(1.0/6.0);
		fh_udg[28*ng+i] = 0.0;
		fh_udg[29*ng+i] = 0.0;
		fh_udg[30*ng+i] = 0.0;
		fh_udg[31*ng+i] = nl1*param1*t2*t6*t7;
		fh_udg[32*ng+i] = 0.0;
		fh_udg[33*ng+i] = nl1*t2*t3*uh3*(2.0/3.0)-nl2*t2*t3*uh2;
		fh_udg[34*ng+i] = -nl1*t2*t3*uh2-nl2*t2*t3*uh3*(4.0/3.0);
		fh_udg[35*ng+i] = t2*t7*t8*(nl2*param1*t4*-6.0-nl2*param1*t5*6.0+nl2*param4*t4*6.0+nl2*param4*t5*8.0+nl2*param1*uh1*uh4*6.0+nl1*param4*uh2*uh3*2.0)*(-1.0/6.0);
		fh_udg[36*ng+i] = 0.0;
		fh_udg[37*ng+i] = t9;
		fh_udg[38*ng+i] = t10;
		fh_udg[39*ng+i] = t2*t7*t8*(t11+t12-nl2*param1*uh1*uh2*6.0)*(1.0/6.0);
		fh_udg[40*ng+i] = 0.0;
		fh_udg[41*ng+i] = nl1*t2*t6*(-2.0/3.0);
		fh_udg[42*ng+i] = nl2*t2*t6*(4.0/3.0);
		fh_udg[43*ng+i] = t2*t7*t8*(nl2*param1*uh1*uh3*6.0+nl1*param4*uh1*uh2*4.0-nl2*param4*uh1*uh3*8.0)*(-1.0/6.0);
		fh_udg[44*ng+i] = 0.0;
		fh_udg[45*ng+i] = 0.0;
		fh_udg[46*ng+i] = 0.0;
		fh_udg[47*ng+i] = nl2*param1*t2*t6*t7;

	}

	for (int i = 0; i <ng; i++) {
		double x1 = pg[0*ng+i];
		double x2 = pg[1*ng+i];
		double u1 = udg[0*ng+i];
		double u2 = udg[1*ng+i];
		double u3 = udg[2*ng+i];
		double u4 = udg[3*ng+i];
		double u5 = udg[4*ng+i];
		double u6 = udg[5*ng+i];
		double u7 = udg[6*ng+i];
		double u8 = udg[7*ng+i];
		double u9 = udg[8*ng+i];
		double u10 = udg[9*ng+i];
		double u11 = udg[10*ng+i];
		double u12 = udg[11*ng+i];
		double uh1 = uh[0*ng+i];
		double uh2 = uh[1*ng+i];
		double uh3 = uh[2*ng+i];
		double uh4 = uh[3*ng+i];
		double nl1 = nl[0*ng+i];
		double nl2 = nl[1*ng+i];

		double t2 = 1.0/(uh1*uh1);
		double t3 = uh2*uh2;
		double t4 = param1-1.0;
		double t5 = 1.0/param3;
		double t6 = 1.0/(uh1*uh1*uh1);
		double t7 = uh3*uh3;
		double t8 = t3+t7-uh1*uh4*2.0;
		double t9 = t2*t4*t8*(1.0/2.0);
		double t10 = 1.0/uh1;
		double t11 = t4*t10*uh4;
		double t12 = u7*uh1;
		double t13 = u10*uh1;
		double t14 = param3*uh1*uh2*uh3;
		double t15 = t12+t13+t14-u5*uh3-u9*uh2;
		double t16 = param3*uh2*uh3;
		double t17 = t16+u7+u10;
		double t18 = uh1*uh1;
		double t19 = 1.0/param4;
		double t20 = t4*t10*uh2;
		double t21 = u9-param3*uh1*uh3;
		double t22 = u5-param3*uh1*uh2;
		fh_uh[0*ng+i] = -param6;
		fh_uh[1*ng+i] = nl1*(t9+t11-t2*t3+t2*t5*(u6*4.0-u11*2.0)*(1.0/3.0)+t5*t6*(u5*uh2*4.0-u6*uh1*4.0-u9*uh3*2.0+u11*uh1*2.0)*(2.0/3.0))+nl2*t2*t5*t17-nl2*t5*t6*t15*2.0;
		fh_uh[2*ng+i] = -nl2*(-t9-t11+t2*t7+t2*t5*(u6*2.0-u11*4.0)*(1.0/3.0)+t5*t6*(u5*uh2*2.0-u6*uh1*2.0-u9*uh3*4.0+u11*uh1*4.0)*(2.0/3.0))+nl1*t2*t5*t17-nl1*t5*t6*t15*2.0;
		fh_uh[3*ng+i] = t5*t19*1.0/(uh1*uh1*uh1*uh1)*(nl1*param1*t3*u5*6.0-nl1*param4*t3*u5*8.0+nl1*param1*t7*u5*6.0+nl2*param1*t3*u9*6.0-nl1*param4*t7*u5*6.0-nl2*param4*t3*u9*6.0+nl2*param1*t7*u9*6.0-nl2*param4*t7*u9*8.0+nl1*param1*t18*u8*6.0+nl2*param1*t18*u12*6.0-nl1*param1*u6*uh1*uh2*6.0-nl1*param1*u5*uh1*uh4*6.0-nl1*param1*u7*uh1*uh3*6.0+nl1*param4*u6*uh1*uh2*8.0+nl1*param4*u7*uh1*uh3*6.0-nl2*param1*u10*uh1*uh2*6.0-nl2*param4*u5*uh2*uh3*2.0-nl2*param4*u6*uh1*uh3*4.0+nl2*param4*u7*uh1*uh2*6.0-nl2*param1*u9*uh1*uh4*6.0-nl2*param1*u11*uh1*uh3*6.0-nl1*param4*u9*uh2*uh3*2.0+nl1*param4*u10*uh1*uh3*6.0-nl1*param4*u11*uh1*uh2*4.0+nl2*param4*u10*uh1*uh2*6.0+nl2*param4*u11*uh1*uh3*8.0+nl1*param3*param4*t3*uh1*uh2*3.0+nl2*param3*param4*t3*uh1*uh3*3.0+nl1*param3*param4*t7*uh1*uh2*3.0+nl2*param3*param4*t7*uh1*uh3*3.0+param3*param4*param6*t18*u4*uh1*6.0-param3*param4*param6*t18*uh1*uh4*6.0-nl1*param1*param3*param4*t3*uh1*uh2*3.0-nl2*param1*param3*param4*t3*uh1*uh3*3.0-nl1*param1*param3*param4*t7*uh1*uh2*3.0-nl2*param1*param3*param4*t7*uh1*uh3*3.0+nl1*param1*param3*param4*t18*uh2*uh4*6.0+nl2*param1*param3*param4*t18*uh3*uh4*6.0)*(-1.0/2.0)+t5*t6*t19*(nl1*param1*u6*uh2*-6.0-nl1*param1*u5*uh4*6.0+nl1*param1*u8*uh1*1.2E1-nl1*param1*u7*uh3*6.0+nl1*param4*u6*uh2*8.0+nl1*param4*u7*uh3*6.0-nl2*param1*u10*uh2*6.0-nl2*param4*u6*uh3*4.0+nl2*param4*u7*uh2*6.0-nl2*param1*u9*uh4*6.0+nl2*param1*u12*uh1*1.2E1-nl2*param1*u11*uh3*6.0+nl1*param4*u10*uh3*6.0-nl1*param4*u11*uh2*4.0+nl2*param4*u10*uh2*6.0+nl2*param4*u11*uh3*8.0+nl1*param3*param4*t3*uh2*3.0+nl2*param3*param4*t3*uh3*3.0+nl1*param3*param4*t7*uh2*3.0+nl2*param3*param4*t7*uh3*3.0+param3*param4*param6*t18*u4*1.8E1-param3*param4*param6*t18*uh4*1.8E1-nl1*param1*param3*param4*t3*uh2*3.0-nl2*param1*param3*param4*t3*uh3*3.0-nl1*param1*param3*param4*t7*uh2*3.0-nl2*param1*param3*param4*t7*uh3*3.0+nl1*param1*param3*param4*uh1*uh2*uh4*1.2E1+nl2*param1*param3*param4*uh1*uh3*uh4*1.2E1)*(1.0/6.0);
		fh_uh[4*ng+i] = nl1;
		fh_uh[5*ng+i] = -param6-nl1*(t20-t10*uh2*2.0+t2*t5*u5*(4.0/3.0))-nl2*t2*t5*t21;
		fh_uh[6*ng+i] = -nl2*(t20-t2*t5*u5*(2.0/3.0))-nl1*t2*t5*t21;
		fh_uh[7*ng+i] = t5*t6*t19*(nl1*param1*u5*uh2*-1.2E1+nl1*param1*u6*uh1*6.0+nl1*param4*u5*uh2*1.6E1-nl1*param4*u6*uh1*8.0-nl2*param1*u9*uh2*1.2E1+nl2*param1*u10*uh1*6.0+nl2*param4*u5*uh3*2.0-nl2*param4*u7*uh1*6.0+nl1*param4*u9*uh3*2.0+nl1*param4*u11*uh1*4.0+nl2*param4*u9*uh2*1.2E1-nl2*param4*u10*uh1*6.0-nl1*param3*param4*t3*uh1*9.0-nl1*param3*param4*t7*uh1*3.0+nl1*param1*param3*param4*t3*uh1*9.0+nl1*param1*param3*param4*t7*uh1*3.0-nl1*param1*param3*param4*t18*uh4*6.0-nl2*param3*param4*uh1*uh2*uh3*6.0+nl2*param1*param3*param4*uh1*uh2*uh3*6.0)*(-1.0/6.0);
		fh_uh[8*ng+i] = nl2;
		fh_uh[9*ng+i] = nl1*(t2*t5*u9*(2.0/3.0)-t4*t10*uh3)-nl2*t2*t5*t22;
		fh_uh[10*ng+i] = -param6-nl2*(t10*uh3*-2.0+t2*t5*u9*(4.0/3.0)+t4*t10*uh3)-nl1*t2*t5*t22;
		fh_uh[11*ng+i] = t5*t6*t19*(nl1*param1*u5*uh3*-1.2E1+nl1*param1*u7*uh1*6.0+nl1*param4*u5*uh3*1.2E1-nl1*param4*u7*uh1*6.0+nl2*param4*u5*uh2*2.0+nl2*param4*u6*uh1*4.0-nl2*param1*u9*uh3*1.2E1+nl2*param1*u11*uh1*6.0+nl1*param4*u9*uh2*2.0-nl1*param4*u10*uh1*6.0+nl2*param4*u9*uh3*1.6E1-nl2*param4*u11*uh1*8.0-nl2*param3*param4*t3*uh1*3.0-nl2*param3*param4*t7*uh1*9.0+nl2*param1*param3*param4*t3*uh1*3.0+nl2*param1*param3*param4*t7*uh1*9.0-nl2*param1*param3*param4*t18*uh4*6.0-nl1*param3*param4*uh1*uh2*uh3*6.0+nl1*param1*param3*param4*uh1*uh2*uh3*6.0)*(-1.0/6.0);
		fh_uh[12*ng+i] = 0.0;
		fh_uh[13*ng+i] = nl1*t4;
		fh_uh[14*ng+i] = nl2*t4;
		fh_uh[15*ng+i] = t5*t6*t19*(nl1*param1*u5*uh1*6.0+nl2*param1*u9*uh1*6.0+param3*param4*param6*t18*uh1*6.0-nl1*param1*param3*param4*t18*uh2*6.0-nl2*param1*param3*param4*t18*uh3*6.0)*(-1.0/6.0);

	}
}

void fhatonly_ns2d(double *fh, double *pg, double *udg, double *uh, double *nl, double *param, double time, int ng, int nc, int ncu, int nd, int ncd)
{
	double param1 = param[0];
	double param2 = param[1];
	double param3 = param[2];
	double param4 = param[3];
	double param5 = param[4];
	double param6 = param[5];

	for (int i = 0; i <ng; i++) {
		double x1 = pg[0*ng+i];
		double x2 = pg[1*ng+i];
		double u1 = udg[0*ng+i];
		double u2 = udg[1*ng+i];
		double u3 = udg[2*ng+i];
		double u4 = udg[3*ng+i];
		double u5 = udg[4*ng+i];
		double u6 = udg[5*ng+i];
		double u7 = udg[6*ng+i];
		double u8 = udg[7*ng+i];
		double u9 = udg[8*ng+i];
		double u10 = udg[9*ng+i];
		double u11 = udg[10*ng+i];
		double u12 = udg[11*ng+i];
		double uh1 = uh[0*ng+i];
		double uh2 = uh[1*ng+i];
		double uh3 = uh[2*ng+i];
		double uh4 = uh[3*ng+i];
		double nl1 = nl[0*ng+i];
		double nl2 = nl[1*ng+i];

		double t2 = 1.0/uh1;
		double t3 = uh2*uh2;
		double t4 = 1.0/param3;
		double t5 = 1.0/(uh1*uh1);
		double t6 = uh3*uh3;
		double t7 = param1-1.0;
		double t8 = t3+t6-uh1*uh4*2.0;
		double t9 = t2*t7*t8*(1.0/2.0);
		double t10 = u7*uh1;
		double t11 = u10*uh1;
		double t12 = param3*uh1*uh2*uh3;
		double t13 = t10+t11+t12-u5*uh3-u9*uh2;
		double t14 = uh1*uh1;
		fh[0*ng+i] = nl1*uh2+nl2*uh3+param6*(u1-uh1);
		fh[1*ng+i] = param6*(u2-uh2)-nl1*(t9-t2*t3+t4*t5*(u5*uh2*4.0-u6*uh1*4.0-u9*uh3*2.0+u11*uh1*2.0)*(1.0/3.0))+nl2*t4*t5*t13;
		fh[2*ng+i] = nl2*(-t9+t2*t6+t4*t5*(u5*uh2*2.0-u6*uh1*2.0-u9*uh3*4.0+u11*uh1*4.0)*(1.0/3.0))+param6*(u3-uh3)+nl1*t4*t5*t13;
		fh[3*ng+i] = (t4*1.0/(uh1*uh1*uh1)*(nl1*param1*t3*u5*6.0+nl1*param1*t6*u5*6.0-nl1*param4*t3*u5*8.0+nl2*param1*t3*u9*6.0-nl1*param4*t6*u5*6.0+nl2*param1*t6*u9*6.0-nl2*param4*t3*u9*6.0-nl2*param4*t6*u9*8.0+nl1*param1*t14*u8*6.0+nl2*param1*t14*u12*6.0-nl1*param1*u6*uh1*uh2*6.0-nl1*param1*u5*uh1*uh4*6.0-nl1*param1*u7*uh1*uh3*6.0+nl1*param4*u6*uh1*uh2*8.0+nl1*param4*u7*uh1*uh3*6.0-nl2*param1*u10*uh1*uh2*6.0-nl2*param4*u5*uh2*uh3*2.0-nl2*param4*u6*uh1*uh3*4.0+nl2*param4*u7*uh1*uh2*6.0-nl2*param1*u9*uh1*uh4*6.0-nl2*param1*u11*uh1*uh3*6.0-nl1*param4*u9*uh2*uh3*2.0+nl1*param4*u10*uh1*uh3*6.0-nl1*param4*u11*uh1*uh2*4.0+nl2*param4*u10*uh1*uh2*6.0+nl2*param4*u11*uh1*uh3*8.0+nl1*param3*param4*t3*uh1*uh2*3.0+nl2*param3*param4*t3*uh1*uh3*3.0+nl1*param3*param4*t6*uh1*uh2*3.0+nl2*param3*param4*t6*uh1*uh3*3.0+param3*param4*param6*t14*u4*uh1*6.0-param3*param4*param6*t14*uh1*uh4*6.0-nl1*param1*param3*param4*t3*uh1*uh2*3.0-nl2*param1*param3*param4*t3*uh1*uh3*3.0-nl1*param1*param3*param4*t6*uh1*uh2*3.0-nl2*param1*param3*param4*t6*uh1*uh3*3.0+nl1*param1*param3*param4*t14*uh2*uh4*6.0+nl2*param1*param3*param4*t14*uh3*uh4*6.0)*(1.0/6.0))/param4;
	}
}

