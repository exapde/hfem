function [Rp Rp_q] = press(q)
% Pressure equation \epsilon p - Rp = 0

[ng ncq] = size(q);
nd = round(sqrt(ncq));

q  = reshape(q,[ng,nd,nd]);

if nd==2
    Rp = q(:,1,1).*q(:,2,2) - q(:,1,2).*q(:,2,1) - 1;
    Rp_q = [q(:,2,2), -q(:,1,2), -q(:,2,1), q(:,1,1)];
%     Rp = -Rp;
%     Rp_q = -Rp_q;
else
    Rp = -q(:,1,1).*q(:,2,2).*q(:,3,3) + q(:,1,1).*q(:,2,3).*q(:,3,2) + ...
         -q(:,1,2).*q(:,2,3).*q(:,3,1) + q(:,1,2).*q(:,2,1).*q(:,3,3) + ...
         -q(:,1,3).*q(:,2,1).*q(:,3,2) + q(:,1,3).*q(:,2,2).*q(:,3,1) - 1;
    Rp_q = -[q(:,2,2).*q(:,3,3) - q(:,2,3).*q(:,3,2),...
            q(:,1,3).*q(:,3,2) - q(:,1,2).*q(:,3,3),...
            q(:,1,2).*q(:,2,3) - q(:,1,3).*q(:,2,2),...
            q(:,2,3).*q(:,3,1) - q(:,2,1).*q(:,3,3),...
            q(:,1,1).*q(:,3,3) - q(:,1,3).*q(:,3,1),...
            q(:,1,3).*q(:,2,1) - q(:,1,1).*q(:,2,3),...
            q(:,2,1).*q(:,3,2) - q(:,2,2).*q(:,3,1),...
            q(:,1,2).*q(:,3,1) - q(:,1,1).*q(:,3,2),...
            q(:,1,1).*q(:,2,2) - q(:,1,2).*q(:,2,1)];
end

% Rp = q(:,1,1);
% Rp_q = zeros(ng,nd,nd);
% Rp_q(:,1,1) = 1;
% for d=2:nd
%     Rp = Rp + q(:,d,d);
%     Rp_q(:,d,d) = 1;
% end
% Rp_q = reshape(Rp_q,[ng ncq]);

