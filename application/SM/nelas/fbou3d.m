function [fb,fb_udg,fb_uh] = fbou3d(ib,uinf,nl,pg,udg,uh,param,time)
%FBOU3D.M
%    [FB,FB_UDG,FB_UH] = FBOU3D(IB,UINF,NL,PG,UDG,UH,PARAM,TIME)
[ng,nc] = size(udg);
nch = 3;
nd = 3;
switch (ib)
    case 1
        one = ones(ng,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 2
        [fb,fb_udg,fb_uh] = fhat(nl,pg,udg,uh,param,time);
        fb = fb - uinf;
    case 3
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u2 = udg(:,2);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        zero = zeros(ng,1);
        t2 = q11.*q32;
        t23 = q12.*q31;
        t3 = t2-t23;
        t4 = q11.*q33;
        t24 = q13.*q31;
        t5 = t4-t24;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q12.*q33;
        t25 = q13.*q32;
        t12 = t11-t25;
        t16 = q11.*q22;
        t26 = q12.*q21;
        t17 = t16-t26;
        t18 = q11.*q23;
        t27 = q13.*q21;
        t19 = t18-t27;
        t20 = q12.*q23;
        t28 = q13.*q22;
        t21 = t20-t28;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+nl3.*(mu.*q23+pres.*t3+mu.*t3.*t10)-nl2.*(-mu.*q22+pres.*t5+mu.*t5.*t10)+nl1.*(mu.*q21+pres.*t12+mu.*t10.*t12)+tau.*(u2-uh2);-uinf3-nl3.*(-mu.*q33+pres.*t17+mu.*t10.*t17)+nl2.*(mu.*q32+pres.*t19+mu.*t10.*t19)-nl1.*(-mu.*q31+pres.*t21+mu.*t10.*t21)+tau.*(u3-uh3)];
        if nargout > 1
            t22 = one.*tau;
            t29 = q22.*q33;
            t32 = q23.*q32;
            t30 = t29-t32;
            t31 = 1.0./t9.^2;
            t33 = pres.*q12;
            t34 = mu.*q12.*t10;
            t35 = pres.*q13;
            t36 = mu.*q13.*t10;
            t37 = pres.*q33;
            t38 = mu.*q33.*t10;
            t39 = q21.*q33;
            t41 = q23.*q31;
            t40 = t39-t41;
            t42 = pres.*q23;
            t43 = mu.*q23.*t10;
            t44 = mu.*t5.*t21.*t31;
            t45 = t35+t36+t44;
            t46 = pres.*q11;
            t47 = mu.*q11.*t10;
            t48 = t35+t36-mu.*t12.*t19.*t31;
            t49 = pres.*q31;
            t50 = mu.*q31.*t10;
            t51 = pres.*q32;
            t52 = mu.*q32.*t10;
            t53 = q21.*q32;
            t55 = q22.*q31;
            t54 = t53-t55;
            t56 = pres.*q21;
            t57 = mu.*q21.*t10;
            t58 = pres.*q22;
            t59 = mu.*q22.*t10;
            t60 = mu.*t3.*t19.*t31;
            t61 = t46+t47+t60;
            t62 = mu.*t3.*t21.*t31;
            t63 = t33+t34+t62;
            t64 = t46+t47-mu.*t5.*t17.*t31;
            t65 = t33+t34-mu.*t12.*t17.*t31;
            fb_udg = [zero;zero;zero;zero;t22;zero;zero;zero;t22;zero;nl3.*t3-nl2.*t5+nl1.*t12;-nl3.*t17+nl2.*t19-nl1.*t21;zero;-nl2.*(t37+t38-mu.*t5.*t30.*t31)+nl3.*(t51+t52-mu.*t3.*t30.*t31)-mu.*nl1.*t12.*t30.*t31;nl2.*(t42+t43-mu.*t19.*t30.*t31)-nl3.*(t58+t59-mu.*t17.*t30.*t31)+mu.*nl1.*t21.*t30.*t31;zero;nl1.*(mu+mu.*t12.^2.*t31)+mu.*nl3.*t3.*t12.*t31-mu.*nl2.*t5.*t12.*t31;-nl2.*t48+nl3.*t65-mu.*nl1.*t12.*t21.*t31;zero;nl2.*t45-nl3.*t63-mu.*nl1.*t12.*t21.*t31;nl1.*(mu+mu.*t21.^2.*t31)+mu.*nl3.*t17.*t21.*t31-mu.*nl2.*t19.*t21.*t31;zero;nl1.*(t37+t38+mu.*t12.*t31.*t40)-nl3.*(t49+t50-mu.*t3.*t31.*t40)-mu.*nl2.*t5.*t31.*t40;-nl1.*(t42+t43+mu.*t21.*t31.*t40)+nl3.*(t56+t57-mu.*t17.*t31.*t40)+mu.*nl2.*t19.*t31.*t40;zero;nl2.*(mu+mu.*t5.^2.*t31)-mu.*nl3.*t3.*t5.*t31-mu.*nl1.*t5.*t12.*t31;nl1.*t45-nl3.*t64-mu.*nl2.*t5.*t19.*t31;zero;-nl1.*t48+nl3.*t61-mu.*nl2.*t5.*t19.*t31;nl2.*(mu+mu.*t19.^2.*t31)-mu.*nl3.*t17.*t19.*t31-mu.*nl1.*t19.*t21.*t31;zero;nl2.*(t49+t50+mu.*t5.*t31.*t54)-nl1.*(t51+t52+mu.*t12.*t31.*t54)-mu.*nl3.*t3.*t31.*t54;-nl2.*(t56+t57+mu.*t19.*t31.*t54)+nl1.*(t58+t59+mu.*t21.*t31.*t54)+mu.*nl3.*t17.*t31.*t54;zero;nl3.*(mu+mu.*t3.^2.*t31)-mu.*nl2.*t3.*t5.*t31+mu.*nl1.*t3.*t12.*t31;nl2.*t61-nl1.*t63-mu.*nl3.*t3.*t17.*t31;zero;nl1.*t65-nl2.*t64-mu.*nl3.*t3.*t17.*t31;nl3.*(mu+mu.*t17.^2.*t31)-mu.*nl2.*t17.*t19.*t31+mu.*nl1.*t17.*t21.*t31];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t22;zero;zero;zero;-t22];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 4
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2 = q21.*q32;
        t23 = q22.*q31;
        t3 = t2-t23;
        t4 = q21.*q33;
        t24 = q23.*q31;
        t5 = t4-t24;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q22.*q33;
        t25 = q23.*q32;
        t12 = t11-t25;
        t16 = q11.*q22;
        t26 = q12.*q21;
        t17 = t16-t26;
        t18 = q11.*q23;
        t27 = q13.*q21;
        t19 = t18-t27;
        t20 = q12.*q23;
        t28 = q13.*q22;
        t21 = t20-t28;
        fb = [-uinf1-nl3.*(-mu.*q13+pres.*t3+mu.*t3.*t10)+nl2.*(mu.*q12+pres.*t5+mu.*t5.*t10)-nl1.*(-mu.*q11+pres.*t12+mu.*t10.*t12)+tau.*(u1-uh1);-uh2+uinf2+x2;-uinf3-nl3.*(-mu.*q33+pres.*t17+mu.*t10.*t17)+nl2.*(mu.*q32+pres.*t19+mu.*t10.*t19)-nl1.*(-mu.*q31+pres.*t21+mu.*t10.*t21)+tau.*(u3-uh3)];
        if nargout > 1
            t22 = one.*tau;
            t29 = 1.0./t9.^2;
            t30 = q12.*q33;
            t32 = q13.*q32;
            t31 = t30-t32;
            t33 = pres.*q22;
            t34 = mu.*q22.*t10;
            t35 = pres.*q23;
            t36 = mu.*q23.*t10;
            t37 = mu.*nl1.*t12.*t21.*t29;
            t38 = mu.*t5.*t21.*t29;
            t39 = t35+t36+t38;
            t40 = pres.*q33;
            t41 = mu.*q33.*t10;
            t42 = q11.*q33;
            t44 = q13.*q31;
            t43 = t42-t44;
            t45 = pres.*q13;
            t46 = mu.*q13.*t10;
            t47 = pres.*q21;
            t48 = mu.*q21.*t10;
            t49 = t35+t36-mu.*t12.*t19.*t29;
            t50 = mu.*nl2.*t5.*t19.*t29;
            t51 = mu.*t3.*t19.*t29;
            t52 = t47+t48+t51;
            t53 = mu.*t3.*t21.*t29;
            t54 = t33+t34+t53;
            t55 = pres.*q31;
            t56 = mu.*q31.*t10;
            t57 = pres.*q32;
            t58 = mu.*q32.*t10;
            t59 = q11.*q32;
            t61 = q12.*q31;
            t60 = t59-t61;
            t62 = pres.*q11;
            t63 = mu.*q11.*t10;
            t64 = pres.*q12;
            t65 = mu.*q12.*t10;
            t66 = t47+t48-mu.*t5.*t17.*t29;
            t67 = t33+t34-mu.*t12.*t17.*t29;
            t68 = mu.*nl3.*t3.*t17.*t29;
            fb_udg = [t22;zero;zero;zero;zero;zero;zero;zero;t22;-nl3.*t3+nl2.*t5-nl1.*t12;zero;-nl3.*t17+nl2.*t19-nl1.*t21;nl1.*(mu+mu.*t12.^2.*t29)+mu.*nl3.*t3.*t12.*t29-mu.*nl2.*t5.*t12.*t29;zero;t37+nl2.*t49-nl3.*t67;nl2.*(t40+t41+mu.*t5.*t29.*t31)-nl3.*(t57+t58+mu.*t3.*t29.*t31)-mu.*nl1.*t12.*t29.*t31;zero;-nl2.*(t45+t46-mu.*t19.*t29.*t31)+nl3.*(t64+t65-mu.*t17.*t29.*t31)-mu.*nl1.*t21.*t29.*t31;t37-nl2.*t39+nl3.*t54;zero;nl1.*(mu+mu.*t21.^2.*t29)+mu.*nl3.*t17.*t21.*t29-mu.*nl2.*t19.*t21.*t29;nl2.*(mu+mu.*t5.^2.*t29)-mu.*nl3.*t3.*t5.*t29-mu.*nl1.*t5.*t12.*t29;zero;t50-nl1.*t39+nl3.*t66;-nl1.*(t40+t41-mu.*t12.*t29.*t43)+nl3.*(t55+t56+mu.*t3.*t29.*t43)-mu.*nl2.*t5.*t29.*t43;zero;nl1.*(t45+t46+mu.*t21.*t29.*t43)-nl3.*(t62+t63-mu.*t17.*t29.*t43)-mu.*nl2.*t19.*t29.*t43;t50+nl1.*t49-nl3.*t52;zero;nl2.*(mu+mu.*t19.^2.*t29)-mu.*nl3.*t17.*t19.*t29-mu.*nl1.*t19.*t21.*t29;nl3.*(mu+mu.*t3.^2.*t29)-mu.*nl2.*t3.*t5.*t29+mu.*nl1.*t3.*t12.*t29;zero;t68-nl2.*t52+nl1.*t54;-nl2.*(t55+t56-mu.*t5.*t29.*t60)+nl1.*(t57+t58-mu.*t12.*t29.*t60)-mu.*nl3.*t3.*t29.*t60;zero;nl2.*(t62+t63+mu.*t19.*t29.*t60)-nl1.*(t64+t65+mu.*t21.*t29.*t60)-mu.*nl3.*t17.*t29.*t60;t68-nl1.*t67+nl2.*t66;zero;nl3.*(mu+mu.*t17.^2.*t29)-mu.*nl2.*t17.*t19.*t29+mu.*nl1.*t17.*t21.*t29];
        end
        if nargout > 2
            fb_uh = [-t22;zero;zero;zero;-one;zero;zero;zero;-t22];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 5
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q21.*q32;
        t23 = q22.*q31;
        t3 = t2-t23;
        t4 = q21.*q33;
        t24 = q23.*q31;
        t5 = t4-t24;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q22.*q33;
        t25 = q23.*q32;
        t12 = t11-t25;
        t16 = q11.*q32;
        t26 = q12.*q31;
        t17 = t16-t26;
        t18 = q11.*q33;
        t27 = q13.*q31;
        t19 = t18-t27;
        t20 = q12.*q33;
        t28 = q13.*q32;
        t21 = t20-t28;
        fb = [-uinf1-nl3.*(-mu.*q13+pres.*t3+mu.*t3.*t10)+nl2.*(mu.*q12+pres.*t5+mu.*t5.*t10)-nl1.*(-mu.*q11+pres.*t12+mu.*t10.*t12)+tau.*(u1-uh1);-uinf2+nl3.*(mu.*q23+pres.*t17+mu.*t10.*t17)-nl2.*(-mu.*q22+pres.*t19+mu.*t10.*t19)+nl1.*(mu.*q21+pres.*t21+mu.*t10.*t21)+tau.*(u2-uh2);-uh3+uinf3+x3];
        if nargout > 1
            t22 = one.*tau;
            t29 = 1.0./t9.^2;
            t30 = pres.*q32;
            t31 = mu.*q32.*t10;
            t32 = pres.*q33;
            t33 = mu.*q33.*t10;
            t34 = q12.*q23;
            t36 = q13.*q22;
            t35 = t34-t36;
            t37 = mu.*t5.*t21.*t29;
            t38 = t32+t33+t37;
            t39 = pres.*q31;
            t40 = mu.*q31.*t10;
            t41 = t32+t33-mu.*t12.*t19.*t29;
            t42 = pres.*q23;
            t43 = mu.*q23.*t10;
            t44 = q11.*q23;
            t46 = q13.*q21;
            t45 = t44-t46;
            t47 = pres.*q13;
            t48 = mu.*q13.*t10;
            t49 = mu.*t3.*t19.*t29;
            t50 = t39+t40+t49;
            t51 = mu.*t3.*t21.*t29;
            t52 = t30+t31+t51;
            t53 = t39+t40-mu.*t5.*t17.*t29;
            t54 = t30+t31-mu.*t12.*t17.*t29;
            t55 = pres.*q21;
            t56 = mu.*q21.*t10;
            t57 = pres.*q22;
            t58 = mu.*q22.*t10;
            t59 = q11.*q22;
            t61 = q12.*q21;
            t60 = t59-t61;
            t62 = pres.*q11;
            t63 = mu.*q11.*t10;
            t64 = pres.*q12;
            t65 = mu.*q12.*t10;
            fb_udg = [t22;zero;zero;zero;t22;zero;zero;zero;zero;-nl3.*t3+nl2.*t5-nl1.*t12;nl3.*t17-nl2.*t19+nl1.*t21;zero;nl1.*(mu+mu.*t12.^2.*t29)+mu.*nl3.*t3.*t12.*t29-mu.*nl2.*t5.*t12.*t29;-nl2.*t41+nl3.*t54-mu.*nl1.*t12.*t21.*t29;zero;nl2.*t38-nl3.*t52-mu.*nl1.*t12.*t21.*t29;nl1.*(mu+mu.*t21.^2.*t29)+mu.*nl3.*t17.*t21.*t29-mu.*nl2.*t19.*t21.*t29;zero;-nl2.*(t42+t43+mu.*t5.*t29.*t35)+nl3.*(t57+t58+mu.*t3.*t29.*t35)+mu.*nl1.*t12.*t29.*t35;nl2.*(t47+t48+mu.*t19.*t29.*t35)-nl3.*(t64+t65+mu.*t17.*t29.*t35)-mu.*nl1.*t21.*t29.*t35;zero;nl2.*(mu+mu.*t5.^2.*t29)-mu.*nl3.*t3.*t5.*t29-mu.*nl1.*t5.*t12.*t29;nl1.*t38-nl3.*t53-mu.*nl2.*t5.*t19.*t29;zero;-nl1.*t41+nl3.*t50-mu.*nl2.*t5.*t19.*t29;nl2.*(mu+mu.*t19.^2.*t29)-mu.*nl3.*t17.*t19.*t29-mu.*nl1.*t19.*t21.*t29;zero;nl1.*(t42+t43-mu.*t12.*t29.*t45)-nl3.*(t55+t56+mu.*t3.*t29.*t45)+mu.*nl2.*t5.*t29.*t45;-nl1.*(t47+t48-mu.*t21.*t29.*t45)+nl3.*(t62+t63+mu.*t17.*t29.*t45)-mu.*nl2.*t19.*t29.*t45;zero;nl3.*(mu+mu.*t3.^2.*t29)-mu.*nl2.*t3.*t5.*t29+mu.*nl1.*t3.*t12.*t29;nl2.*t50-nl1.*t52-mu.*nl3.*t3.*t17.*t29;zero;nl1.*t54-nl2.*t53-mu.*nl3.*t3.*t17.*t29;nl3.*(mu+mu.*t17.^2.*t29)-mu.*nl2.*t17.*t19.*t29+mu.*nl1.*t17.*t21.*t29;zero;nl2.*(t55+t56-mu.*t5.*t29.*t60)-nl1.*(t57+t58-mu.*t12.*t29.*t60)+mu.*nl3.*t3.*t29.*t60;-nl2.*(t62+t63-mu.*t19.*t29.*t60)+nl1.*(t64+t65-mu.*t21.*t29.*t60)-mu.*nl3.*t17.*t29.*t60;zero];
        end
        if nargout > 2
            fb_uh = [-t22;zero;zero;zero;-t22;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 6
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2 = q11.*q22;
        t16 = q12.*q21;
        t3 = t2-t16;
        t4 = q11.*q23;
        t17 = q13.*q21;
        t5 = t4-t17;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q12.*q23;
        t18 = q13.*q22;
        t12 = t11-t18;
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uinf3-nl3.*(-mu.*q33+pres.*t3+mu.*t3.*t10)+nl2.*(mu.*q32+pres.*t5+mu.*t5.*t10)-nl1.*(-mu.*q31+pres.*t12+mu.*t10.*t12)+tau.*(u3-uh3)];
        if nargout > 1
            t19 = q22.*q33;
            t22 = q23.*q32;
            t20 = t19-t22;
            t21 = 1.0./t9.^2;
            t23 = q12.*q33;
            t25 = q13.*q32;
            t24 = t23-t25;
            t26 = pres.*q23;
            t27 = mu.*q23.*t10;
            t28 = q21.*q33;
            t30 = q23.*q31;
            t29 = t28-t30;
            t31 = pres.*q13;
            t32 = mu.*q13.*t10;
            t33 = q11.*q33;
            t35 = q13.*q31;
            t34 = t33-t35;
            t36 = pres.*q21;
            t37 = mu.*q21.*t10;
            t38 = pres.*q22;
            t39 = mu.*q22.*t10;
            t40 = q21.*q32;
            t42 = q22.*q31;
            t41 = t40-t42;
            t43 = pres.*q11;
            t44 = mu.*q11.*t10;
            t45 = pres.*q12;
            t46 = mu.*q12.*t10;
            t47 = q11.*q32;
            t49 = q12.*q31;
            t48 = t47-t49;
            t50 = one.*tau;
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;t50;zero;zero;-nl3.*t3+nl2.*t5-nl1.*t12;zero;zero;nl2.*(t26+t27-mu.*t5.*t20.*t21)-nl3.*(t38+t39-mu.*t3.*t20.*t21)+mu.*nl1.*t12.*t20.*t21;zero;zero;-nl2.*(t31+t32-mu.*t5.*t21.*t24)+nl3.*(t45+t46-mu.*t3.*t21.*t24)-mu.*nl1.*t12.*t21.*t24;zero;zero;nl1.*(mu+mu.*t12.^2.*t21)+mu.*nl3.*t3.*t12.*t21-mu.*nl2.*t5.*t12.*t21;zero;zero;-nl1.*(t26+t27+mu.*t12.*t21.*t29)+nl3.*(t36+t37-mu.*t3.*t21.*t29)+mu.*nl2.*t5.*t21.*t29;zero;zero;nl1.*(t31+t32+mu.*t12.*t21.*t34)-nl3.*(t43+t44-mu.*t3.*t21.*t34)-mu.*nl2.*t5.*t21.*t34;zero;zero;nl2.*(mu+mu.*t5.^2.*t21)-mu.*nl3.*t3.*t5.*t21-mu.*nl1.*t5.*t12.*t21;zero;zero;-nl2.*(t36+t37+mu.*t5.*t21.*t41)+nl1.*(t38+t39+mu.*t12.*t21.*t41)+mu.*nl3.*t3.*t21.*t41;zero;zero;nl2.*(t43+t44+mu.*t5.*t21.*t48)-nl1.*(t45+t46+mu.*t12.*t21.*t48)-mu.*nl3.*t3.*t21.*t48;zero;zero;nl3.*(mu+mu.*t3.^2.*t21)-mu.*nl2.*t3.*t5.*t21+mu.*nl1.*t3.*t12.*t21];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-t50];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 7
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u1 = udg(:,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q21.*q32;
        t16 = q22.*q31;
        t3 = t2-t16;
        t4 = q21.*q33;
        t17 = q23.*q31;
        t5 = t4-t17;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q22.*q33;
        t18 = q23.*q32;
        t12 = t11-t18;
        fb = [-uinf1-nl3.*(-mu.*q13+pres.*t3+mu.*t3.*t10)+nl2.*(mu.*q12+pres.*t5+mu.*t5.*t10)-nl1.*(-mu.*q11+pres.*t12+mu.*t10.*t12)+tau.*(u1-uh1);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            t19 = 1.0./t9.^2;
            t20 = q12.*q33;
            t22 = q13.*q32;
            t21 = t20-t22;
            t23 = q12.*q23;
            t25 = q13.*q22;
            t24 = t23-t25;
            t26 = pres.*q33;
            t27 = mu.*q33.*t10;
            t28 = q11.*q33;
            t30 = q13.*q31;
            t29 = t28-t30;
            t31 = pres.*q23;
            t32 = mu.*q23.*t10;
            t33 = q11.*q23;
            t35 = q13.*q21;
            t34 = t33-t35;
            t36 = pres.*q31;
            t37 = mu.*q31.*t10;
            t38 = pres.*q32;
            t39 = mu.*q32.*t10;
            t40 = q11.*q32;
            t42 = q12.*q31;
            t41 = t40-t42;
            t43 = pres.*q21;
            t44 = mu.*q21.*t10;
            t45 = pres.*q22;
            t46 = mu.*q22.*t10;
            t47 = q11.*q22;
            t49 = q12.*q21;
            t48 = t47-t49;
            t50 = one.*tau;
            fb_udg = [t50;zero;zero;zero;zero;zero;zero;zero;zero;-nl3.*t3+nl2.*t5-nl1.*t12;zero;zero;nl1.*(mu+mu.*t12.^2.*t19)+mu.*nl3.*t3.*t12.*t19-mu.*nl2.*t5.*t12.*t19;zero;zero;nl2.*(t26+t27+mu.*t5.*t19.*t21)-nl3.*(t38+t39+mu.*t3.*t19.*t21)-mu.*nl1.*t12.*t19.*t21;zero;zero;-nl2.*(t31+t32+mu.*t5.*t19.*t24)+nl3.*(t45+t46+mu.*t3.*t19.*t24)+mu.*nl1.*t12.*t19.*t24;zero;zero;nl2.*(mu+mu.*t5.^2.*t19)-mu.*nl3.*t3.*t5.*t19-mu.*nl1.*t5.*t12.*t19;zero;zero;-nl1.*(t26+t27-mu.*t12.*t19.*t29)+nl3.*(t36+t37+mu.*t3.*t19.*t29)-mu.*nl2.*t5.*t19.*t29;zero;zero;nl1.*(t31+t32-mu.*t12.*t19.*t34)-nl3.*(t43+t44+mu.*t3.*t19.*t34)+mu.*nl2.*t5.*t19.*t34;zero;zero;nl3.*(mu+mu.*t3.^2.*t19)-mu.*nl2.*t3.*t5.*t19+mu.*nl1.*t3.*t12.*t19;zero;zero;-nl2.*(t36+t37-mu.*t5.*t19.*t41)+nl1.*(t38+t39-mu.*t12.*t19.*t41)-mu.*nl3.*t3.*t19.*t41;zero;zero;nl2.*(t43+t44-mu.*t5.*t19.*t48)-nl1.*(t45+t46-mu.*t12.*t19.*t48)+mu.*nl3.*t3.*t19.*t48;zero;zero];
        end
        if nargout > 2
            fb_uh = [-t50;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 8
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        pres = udg(:,4);
        q11 = udg(:,5);
        q12 = udg(:,8);
        q13 = udg(:,11);
        q21 = udg(:,6);
        q22 = udg(:,9);
        q23 = udg(:,12);
        q31 = udg(:,7);
        q32 = udg(:,10);
        q33 = udg(:,13);
        tau = param{3};
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q11.*q32;
        t16 = q12.*q31;
        t3 = t2-t16;
        t4 = q11.*q33;
        t17 = q13.*q31;
        t5 = t4-t17;
        t6 = q11.*q22.*q33;
        t7 = q12.*q23.*q31;
        t8 = q13.*q21.*q32;
        t13 = q11.*q23.*q32;
        t14 = q12.*q21.*q33;
        t15 = q13.*q22.*q31;
        t9 = t6+t7+t8-t13-t14-t15;
        t10 = 1.0./t9;
        t11 = q12.*q33;
        t18 = q13.*q32;
        t12 = t11-t18;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+nl3.*(mu.*q23+pres.*t3+mu.*t3.*t10)-nl2.*(-mu.*q22+pres.*t5+mu.*t5.*t10)+nl1.*(mu.*q21+pres.*t12+mu.*t10.*t12)+tau.*(u2-uh2);-uh3+uinf3+x3];
        if nargout > 1
            t19 = q22.*q33;
            t22 = q23.*q32;
            t20 = t19-t22;
            t21 = 1.0./t9.^2;
            t23 = q12.*q23;
            t25 = q13.*q22;
            t24 = t23-t25;
            t26 = pres.*q33;
            t27 = mu.*q33.*t10;
            t28 = q21.*q33;
            t30 = q23.*q31;
            t29 = t28-t30;
            t31 = pres.*q13;
            t32 = mu.*q13.*t10;
            t33 = q11.*q23;
            t35 = q13.*q21;
            t34 = t33-t35;
            t36 = pres.*q31;
            t37 = mu.*q31.*t10;
            t38 = pres.*q32;
            t39 = mu.*q32.*t10;
            t40 = q21.*q32;
            t42 = q22.*q31;
            t41 = t40-t42;
            t43 = pres.*q11;
            t44 = mu.*q11.*t10;
            t45 = pres.*q12;
            t46 = mu.*q12.*t10;
            t47 = q11.*q22;
            t49 = q12.*q21;
            t48 = t47-t49;
            t50 = one.*tau;
            fb_udg = [zero;zero;zero;zero;t50;zero;zero;zero;zero;zero;nl3.*t3-nl2.*t5+nl1.*t12;zero;zero;-nl2.*(t26+t27-mu.*t5.*t20.*t21)+nl3.*(t38+t39-mu.*t3.*t20.*t21)-mu.*nl1.*t12.*t20.*t21;zero;zero;nl1.*(mu+mu.*t12.^2.*t21)+mu.*nl3.*t3.*t12.*t21-mu.*nl2.*t5.*t12.*t21;zero;zero;nl2.*(t31+t32+mu.*t5.*t21.*t24)-nl3.*(t45+t46+mu.*t3.*t21.*t24)-mu.*nl1.*t12.*t21.*t24;zero;zero;nl1.*(t26+t27+mu.*t12.*t21.*t29)-nl3.*(t36+t37-mu.*t3.*t21.*t29)-mu.*nl2.*t5.*t21.*t29;zero;zero;nl2.*(mu+mu.*t5.^2.*t21)-mu.*nl3.*t3.*t5.*t21-mu.*nl1.*t5.*t12.*t21;zero;zero;-nl1.*(t31+t32-mu.*t12.*t21.*t34)+nl3.*(t43+t44+mu.*t3.*t21.*t34)-mu.*nl2.*t5.*t21.*t34;zero;zero;nl2.*(t36+t37+mu.*t5.*t21.*t41)-nl1.*(t38+t39+mu.*t12.*t21.*t41)-mu.*nl3.*t3.*t21.*t41;zero;zero;nl3.*(mu+mu.*t3.^2.*t21)-mu.*nl2.*t3.*t5.*t21+mu.*nl1.*t3.*t12.*t21;zero;zero;-nl2.*(t43+t44-mu.*t5.*t21.*t48)+nl1.*(t45+t46-mu.*t12.*t21.*t48)-mu.*nl3.*t3.*t21.*t48;zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t50;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    otherwise
         error('unknown boundary type');
end
