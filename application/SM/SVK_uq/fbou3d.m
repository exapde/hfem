function [fb,fb_udg,fb_uh] = fbou3d(ib,uinf,nl,pg,udg,uh,param,time)
%FBOU3D.M
%    [FB,FB_UDG,FB_UH] = FBOU3D(IB,UINF,NL,PG,UDG,UH,PARAM,TIME)
[ng,nc] = size(udg);
nch = 3;
nd = 3;
switch (ib)
    case 1
        one = ones(ng,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero;zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 2
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u1 = udg(:,1);
        u2 = udg(:,2);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = t21+t35;
        t37 = t9+t11+t13-1.0./2.0;
        t38 = mu.*t37.*2.0;
        t39 = t21+t38;
        t40 = t15+t17+t19-1.0./2.0;
        t41 = mu.*t40.*2.0;
        t42 = t21+t41;
        fb = [-uinf1+tau.*(u1-uh1)+nl1.*(q11.*t36+mu.*q12.*t25.*2.0+mu.*q13.*t29.*2.0)+nl2.*(q12.*t39+mu.*q11.*t25.*2.0+mu.*q13.*t33.*2.0)+nl3.*(q13.*t42+mu.*q11.*t29.*2.0+mu.*q12.*t33.*2.0);-uinf2+tau.*(u2-uh2)+nl1.*(q21.*t36+mu.*q22.*t25.*2.0+mu.*q23.*t29.*2.0)+nl2.*(q22.*t39+mu.*q21.*t25.*2.0+mu.*q23.*t33.*2.0)+nl3.*(q23.*t42+mu.*q21.*t29.*2.0+mu.*q22.*t33.*2.0);-uinf3+tau.*(u3-uh3)+nl1.*(q31.*t36+mu.*q32.*t25.*2.0+mu.*q33.*t29.*2.0)+nl2.*(q32.*t39+mu.*q31.*t25.*2.0+mu.*q33.*t33.*2.0)+nl3.*(q33.*t42+mu.*q31.*t29.*2.0+mu.*q32.*t33.*2.0)];
        if nargout > 1
            t43 = one.*tau;
            t44 = lambda.*q11;
            t45 = mu.*q11.*2.0;
            t46 = t44+t45;
            t47 = mu.*q12.*q22;
            t48 = mu.*q13.*q23;
            t49 = mu.*t25.*2.0;
            t50 = mu.*t29.*2.0;
            t51 = lambda.*q21;
            t52 = mu.*q21.*2.0;
            t53 = t51+t52;
            t54 = mu.*q12.*q32;
            t55 = mu.*q13.*q33;
            t56 = lambda.*q31;
            t57 = mu.*q31.*2.0;
            t58 = t56+t57;
            t59 = mu.*q22.*q32;
            t60 = mu.*q23.*q33;
            t61 = lambda.*q11.*q12;
            t62 = mu.*q11.*q12;
            t63 = t49+t61+t62;
            t64 = mu.*t14;
            t65 = lambda.*q12;
            t66 = mu.*q12.*2.0;
            t67 = t65+t66;
            t68 = lambda.*q12.*q21;
            t69 = mu.*q11.*q22;
            t70 = t68+t69;
            t71 = lambda.*q12.*q31;
            t72 = mu.*q11.*q32;
            t73 = t71+t72;
            t74 = mu.*q11.*q21;
            t75 = lambda.*q11.*q22;
            t76 = mu.*q12.*q21;
            t77 = t75+t76;
            t78 = lambda.*q21.*q22;
            t79 = mu.*q21.*q22;
            t80 = t49+t78+t79;
            t81 = mu.*t33.*2.0;
            t82 = mu.*t16;
            t83 = lambda.*q22;
            t84 = mu.*q22.*2.0;
            t85 = t83+t84;
            t86 = lambda.*q22.*q31;
            t87 = mu.*q21.*q32;
            t88 = t86+t87;
            t89 = mu.*q11.*q31;
            t90 = lambda.*q11.*q32;
            t91 = mu.*q12.*q31;
            t92 = t90+t91;
            t93 = lambda.*q32;
            t94 = mu.*q32.*2.0;
            t95 = t93+t94;
            t96 = mu.*q21.*q31;
            t97 = lambda.*q21.*q32;
            t98 = mu.*q22.*q31;
            t99 = t97+t98;
            t100 = lambda.*q31.*q32;
            t101 = mu.*q31.*q32;
            t102 = t49+t100+t101;
            t103 = mu.*t18;
            t104 = lambda.*q11.*q13;
            t105 = mu.*q11.*q13;
            t106 = t50+t104+t105;
            t107 = lambda.*q12.*q13;
            t108 = mu.*q12.*q13;
            t109 = t81+t107+t108;
            t110 = mu.*t2;
            t111 = mu.*t8;
            t112 = lambda.*q13;
            t113 = mu.*q13.*2.0;
            t114 = t112+t113;
            t115 = lambda.*q13.*q21;
            t116 = mu.*q11.*q23;
            t117 = t115+t116;
            t118 = lambda.*q13.*q22;
            t119 = mu.*q12.*q23;
            t120 = t118+t119;
            t121 = lambda.*q13.*q31;
            t122 = mu.*q11.*q33;
            t123 = t121+t122;
            t124 = lambda.*q13.*q32;
            t125 = mu.*q12.*q33;
            t126 = t124+t125;
            t127 = lambda.*q11.*q23;
            t128 = mu.*q13.*q21;
            t129 = t127+t128;
            t130 = lambda.*q12.*q23;
            t131 = mu.*q13.*q22;
            t132 = t130+t131;
            t133 = lambda.*q21.*q23;
            t134 = mu.*q21.*q23;
            t135 = t50+t133+t134;
            t136 = lambda.*q22.*q23;
            t137 = mu.*q22.*q23;
            t138 = t81+t136+t137;
            t139 = mu.*t4;
            t140 = mu.*t10;
            t141 = lambda.*q23;
            t142 = mu.*q23.*2.0;
            t143 = t141+t142;
            t144 = lambda.*q23.*q31;
            t145 = mu.*q21.*q33;
            t146 = t144+t145;
            t147 = lambda.*q23.*q32;
            t148 = mu.*q22.*q33;
            t149 = t147+t148;
            t150 = lambda.*q11.*q33;
            t151 = mu.*q13.*q31;
            t152 = t150+t151;
            t153 = lambda.*q12.*q33;
            t154 = mu.*q13.*q32;
            t155 = t153+t154;
            t156 = lambda.*q33;
            t157 = mu.*q33.*2.0;
            t158 = t156+t157;
            t159 = lambda.*q21.*q33;
            t160 = mu.*q23.*q31;
            t161 = t159+t160;
            t162 = lambda.*q22.*q33;
            t163 = mu.*q23.*q32;
            t164 = t162+t163;
            t165 = lambda.*q31.*q33;
            t166 = mu.*q31.*q33;
            t167 = t50+t165+t166;
            t168 = lambda.*q32.*q33;
            t169 = mu.*q32.*q33;
            t170 = t81+t168+t169;
            t171 = mu.*t6;
            t172 = mu.*t12;
            fb_udg = [t43;zero;zero;zero;t43;zero;zero;zero;t43;nl1.*(t21+t35+t64+t111+q11.*t46)+nl2.*t63+nl3.*t106;nl2.*t77+nl3.*t129+nl1.*(t47+t48+q21.*t46);nl2.*t92+nl3.*t152+nl1.*(t54+t55+q31.*t46);nl2.*t70+nl3.*t117+nl1.*(t47+t48+q11.*t53);nl1.*(t21+t35+t82+t140+q21.*t53)+nl2.*t80+nl3.*t135;nl2.*t99+nl3.*t161+nl1.*(t59+t60+q31.*t53);nl2.*t73+nl3.*t123+nl1.*(t54+t55+q11.*t58);nl2.*t88+nl3.*t146+nl1.*(t59+t60+q21.*t58);nl1.*(t21+t35+t103+t172+q31.*t58)+nl2.*t102+nl3.*t167;nl2.*(t21+t38+t64+t110+q12.*t67)+nl1.*t63+nl3.*t109;nl1.*t70+nl3.*t132+nl2.*(t48+t74+q22.*t67);nl1.*t73+nl3.*t155+nl2.*(t55+t89+q32.*t67);nl1.*t77+nl3.*t120+nl2.*(t48+t74+q12.*t85);nl2.*(t21+t38+t82+t139+q22.*t85)+nl1.*t80+nl3.*t138;nl1.*t88+nl3.*t164+nl2.*(t60+t96+q32.*t85);nl1.*t92+nl3.*t126+nl2.*(t55+t89+q12.*t95);nl1.*t99+nl3.*t149+nl2.*(t60+t96+q22.*t95);nl2.*(t21+t38+t103+t171+q32.*t95)+nl1.*t102+nl3.*t170;nl3.*(t21+t41+t110+t111+q13.*t114)+nl1.*t106+nl2.*t109;nl1.*t117+nl2.*t120+nl3.*(t47+t74+q23.*t114);nl1.*t123+nl2.*t126+nl3.*(t54+t89+q33.*t114);nl1.*t129+nl2.*t132+nl3.*(t47+t74+q13.*t143);nl3.*(t21+t41+t139+t140+q23.*t143)+nl1.*t135+nl2.*t138;nl1.*t146+nl2.*t149+nl3.*(t59+t96+q33.*t143);nl1.*t152+nl2.*t155+nl3.*(t54+t89+q13.*t158);nl1.*t161+nl2.*t164+nl3.*(t59+t96+q23.*t158);nl3.*(t21+t41+t171+t172+q33.*t158)+nl1.*t167+nl2.*t170];
        end
        if nargout > 2
            fb_uh = [-t43;zero;zero;zero;-t43;zero;zero;zero;-t43];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 3
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u2 = udg(:,2);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = t21+t35;
        t37 = t9+t11+t13-1.0./2.0;
        t38 = mu.*t37.*2.0;
        t39 = t21+t38;
        t40 = t15+t17+t19-1.0./2.0;
        t41 = mu.*t40.*2.0;
        t42 = t21+t41;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+tau.*(u2-uh2)+nl1.*(q21.*t36+mu.*q22.*t25.*2.0+mu.*q23.*t29.*2.0)+nl2.*(q22.*t39+mu.*q21.*t25.*2.0+mu.*q23.*t33.*2.0)+nl3.*(q23.*t42+mu.*q21.*t29.*2.0+mu.*q22.*t33.*2.0);-uinf3+tau.*(u3-uh3)+nl1.*(q31.*t36+mu.*q32.*t25.*2.0+mu.*q33.*t29.*2.0)+nl2.*(q32.*t39+mu.*q31.*t25.*2.0+mu.*q33.*t33.*2.0)+nl3.*(q33.*t42+mu.*q31.*t29.*2.0+mu.*q32.*t33.*2.0)];
        if nargout > 1
            t43 = one.*tau;
            t44 = lambda.*q11;
            t45 = mu.*q11.*2.0;
            t46 = t44+t45;
            t47 = lambda.*q21;
            t48 = mu.*q21.*2.0;
            t49 = t47+t48;
            t50 = mu.*q22.*q32;
            t51 = mu.*q23.*q33;
            t52 = mu.*t25.*2.0;
            t53 = mu.*t29.*2.0;
            t54 = lambda.*q31;
            t55 = mu.*q31.*2.0;
            t56 = t54+t55;
            t57 = mu.*q13.*q23;
            t58 = lambda.*q12;
            t59 = mu.*q12.*2.0;
            t60 = t58+t59;
            t61 = mu.*q13.*q33;
            t62 = lambda.*q21.*q22;
            t63 = mu.*q21.*q22;
            t64 = t52+t62+t63;
            t65 = mu.*t16;
            t66 = lambda.*q22;
            t67 = mu.*q22.*2.0;
            t68 = t66+t67;
            t69 = lambda.*q22.*q31;
            t70 = mu.*q21.*q32;
            t71 = t69+t70;
            t72 = mu.*q21.*q31;
            t73 = lambda.*q21.*q32;
            t74 = mu.*q22.*q31;
            t75 = t73+t74;
            t76 = lambda.*q31.*q32;
            t77 = mu.*q31.*q32;
            t78 = t52+t76+t77;
            t79 = mu.*t33.*2.0;
            t80 = mu.*t18;
            t81 = lambda.*q32;
            t82 = mu.*q32.*2.0;
            t83 = t81+t82;
            t84 = mu.*q11.*q21;
            t85 = mu.*q12.*q22;
            t86 = lambda.*q13;
            t87 = mu.*q13.*2.0;
            t88 = t86+t87;
            t89 = mu.*q11.*q31;
            t90 = mu.*q12.*q32;
            t91 = lambda.*q21.*q23;
            t92 = mu.*q21.*q23;
            t93 = t53+t91+t92;
            t94 = lambda.*q22.*q23;
            t95 = mu.*q22.*q23;
            t96 = t79+t94+t95;
            t97 = mu.*t4;
            t98 = mu.*t10;
            t99 = lambda.*q23;
            t100 = mu.*q23.*2.0;
            t101 = t99+t100;
            t102 = lambda.*q23.*q31;
            t103 = mu.*q21.*q33;
            t104 = t102+t103;
            t105 = lambda.*q23.*q32;
            t106 = mu.*q22.*q33;
            t107 = t105+t106;
            t108 = lambda.*q21.*q33;
            t109 = mu.*q23.*q31;
            t110 = t108+t109;
            t111 = lambda.*q22.*q33;
            t112 = mu.*q23.*q32;
            t113 = t111+t112;
            t114 = lambda.*q31.*q33;
            t115 = mu.*q31.*q33;
            t116 = t53+t114+t115;
            t117 = lambda.*q32.*q33;
            t118 = mu.*q32.*q33;
            t119 = t79+t117+t118;
            t120 = mu.*t6;
            t121 = mu.*t12;
            t122 = lambda.*q33;
            t123 = mu.*q33.*2.0;
            t124 = t122+t123;
            fb_udg = [zero;zero;zero;zero;t43;zero;zero;zero;t43;zero;nl1.*(t57+t85+q21.*t46)+nl2.*(lambda.*q11.*q22+mu.*q12.*q21)+nl3.*(lambda.*q11.*q23+mu.*q13.*q21);nl1.*(t61+t90+q31.*t46)+nl2.*(lambda.*q11.*q32+mu.*q12.*q31)+nl3.*(lambda.*q11.*q33+mu.*q13.*q31);zero;nl1.*(t21+t35+t65+t98+q21.*t49)+nl2.*t64+nl3.*t93;nl2.*t75+nl3.*t110+nl1.*(t50+t51+q31.*t49);zero;nl2.*t71+nl3.*t104+nl1.*(t50+t51+q21.*t56);nl1.*(t21+t35+t80+t121+q31.*t56)+nl2.*t78+nl3.*t116;zero;nl2.*(t57+t84+q22.*t60)+nl1.*(lambda.*q12.*q21+mu.*q11.*q22)+nl3.*(lambda.*q12.*q23+mu.*q13.*q22);nl2.*(t61+t89+q32.*t60)+nl1.*(lambda.*q12.*q31+mu.*q11.*q32)+nl3.*(lambda.*q12.*q33+mu.*q13.*q32);zero;nl2.*(t21+t38+t65+t97+q22.*t68)+nl1.*t64+nl3.*t96;nl1.*t71+nl3.*t113+nl2.*(t51+t72+q32.*t68);zero;nl1.*t75+nl3.*t107+nl2.*(t51+t72+q22.*t83);nl2.*(t21+t38+t80+t120+q32.*t83)+nl1.*t78+nl3.*t119;zero;nl3.*(t84+t85+q23.*t88)+nl1.*(lambda.*q13.*q21+mu.*q11.*q23)+nl2.*(lambda.*q13.*q22+mu.*q12.*q23);nl3.*(t89+t90+q33.*t88)+nl1.*(lambda.*q13.*q31+mu.*q11.*q33)+nl2.*(lambda.*q13.*q32+mu.*q12.*q33);zero;nl3.*(t21+t41+t97+t98+q23.*t101)+nl1.*t93+nl2.*t96;nl1.*t104+nl2.*t107+nl3.*(t50+t72+q33.*t101);zero;nl1.*t110+nl2.*t113+nl3.*(t50+t72+q23.*t124);nl3.*(t21+t41+t120+t121+q33.*t124)+nl1.*t116+nl2.*t119];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t43;zero;zero;zero;-t43];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 4
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u1 = udg(:,1);
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = t21+t35;
        t37 = t9+t11+t13-1.0./2.0;
        t38 = mu.*t37.*2.0;
        t39 = t21+t38;
        t40 = t15+t17+t19-1.0./2.0;
        t41 = mu.*t40.*2.0;
        t42 = t21+t41;
        fb = [-uinf1+tau.*(u1-uh1)+nl1.*(q11.*t36+mu.*q12.*t25.*2.0+mu.*q13.*t29.*2.0)+nl2.*(q12.*t39+mu.*q11.*t25.*2.0+mu.*q13.*t33.*2.0)+nl3.*(q13.*t42+mu.*q11.*t29.*2.0+mu.*q12.*t33.*2.0);-uh2+uinf2+x2;-uinf3+tau.*(u3-uh3)+nl1.*(q31.*t36+mu.*q32.*t25.*2.0+mu.*q33.*t29.*2.0)+nl2.*(q32.*t39+mu.*q31.*t25.*2.0+mu.*q33.*t33.*2.0)+nl3.*(q33.*t42+mu.*q31.*t29.*2.0+mu.*q32.*t33.*2.0)];
        if nargout > 1
            t43 = one.*tau;
            t44 = lambda.*q11;
            t45 = mu.*q11.*2.0;
            t46 = t44+t45;
            t47 = lambda.*q21;
            t48 = mu.*q21.*2.0;
            t49 = t47+t48;
            t50 = mu.*q12.*q32;
            t51 = mu.*q13.*q33;
            t52 = mu.*t25.*2.0;
            t53 = mu.*t29.*2.0;
            t54 = lambda.*q31;
            t55 = mu.*q31.*2.0;
            t56 = t54+t55;
            t57 = lambda.*q11.*q12;
            t58 = mu.*q11.*q12;
            t59 = t52+t57+t58;
            t60 = mu.*t14;
            t61 = lambda.*q12;
            t62 = mu.*q12.*2.0;
            t63 = t61+t62;
            t64 = lambda.*q12.*q31;
            t65 = mu.*q11.*q32;
            t66 = t64+t65;
            t67 = mu.*q13.*q23;
            t68 = lambda.*q22;
            t69 = mu.*q22.*2.0;
            t70 = t68+t69;
            t71 = mu.*q23.*q33;
            t72 = mu.*q11.*q31;
            t73 = lambda.*q11.*q32;
            t74 = mu.*q12.*q31;
            t75 = t73+t74;
            t76 = lambda.*q31.*q32;
            t77 = mu.*q31.*q32;
            t78 = t52+t76+t77;
            t79 = mu.*t33.*2.0;
            t80 = mu.*t18;
            t81 = lambda.*q32;
            t82 = mu.*q32.*2.0;
            t83 = t81+t82;
            t84 = lambda.*q11.*q13;
            t85 = mu.*q11.*q13;
            t86 = t53+t84+t85;
            t87 = lambda.*q12.*q13;
            t88 = mu.*q12.*q13;
            t89 = t79+t87+t88;
            t90 = mu.*t2;
            t91 = mu.*t8;
            t92 = lambda.*q13;
            t93 = mu.*q13.*2.0;
            t94 = t92+t93;
            t95 = lambda.*q13.*q31;
            t96 = mu.*q11.*q33;
            t97 = t95+t96;
            t98 = lambda.*q13.*q32;
            t99 = mu.*q12.*q33;
            t100 = t98+t99;
            t101 = mu.*q11.*q21;
            t102 = mu.*q12.*q22;
            t103 = lambda.*q23;
            t104 = mu.*q23.*2.0;
            t105 = t103+t104;
            t106 = mu.*q21.*q31;
            t107 = mu.*q22.*q32;
            t108 = lambda.*q11.*q33;
            t109 = mu.*q13.*q31;
            t110 = t108+t109;
            t111 = lambda.*q12.*q33;
            t112 = mu.*q13.*q32;
            t113 = t111+t112;
            t114 = lambda.*q31.*q33;
            t115 = mu.*q31.*q33;
            t116 = t53+t114+t115;
            t117 = lambda.*q32.*q33;
            t118 = mu.*q32.*q33;
            t119 = t79+t117+t118;
            t120 = mu.*t6;
            t121 = mu.*t12;
            t122 = lambda.*q33;
            t123 = mu.*q33.*2.0;
            t124 = t122+t123;
            fb_udg = [t43;zero;zero;zero;zero;zero;zero;zero;t43;nl1.*(t21+t35+t60+t91+q11.*t46)+nl2.*t59+nl3.*t86;zero;nl2.*t75+nl3.*t110+nl1.*(t50+t51+q31.*t46);nl1.*(t67+t102+q11.*t49)+nl2.*(lambda.*q12.*q21+mu.*q11.*q22)+nl3.*(lambda.*q13.*q21+mu.*q11.*q23);zero;nl1.*(t71+t107+q31.*t49)+nl2.*(lambda.*q21.*q32+mu.*q22.*q31)+nl3.*(lambda.*q21.*q33+mu.*q23.*q31);nl2.*t66+nl3.*t97+nl1.*(t50+t51+q11.*t56);zero;nl1.*(t21+t35+t80+t121+q31.*t56)+nl2.*t78+nl3.*t116;nl2.*(t21+t38+t60+t90+q12.*t63)+nl1.*t59+nl3.*t89;zero;nl1.*t66+nl3.*t113+nl2.*(t51+t72+q32.*t63);nl2.*(t67+t101+q12.*t70)+nl1.*(lambda.*q11.*q22+mu.*q12.*q21)+nl3.*(lambda.*q13.*q22+mu.*q12.*q23);zero;nl2.*(t71+t106+q32.*t70)+nl1.*(lambda.*q22.*q31+mu.*q21.*q32)+nl3.*(lambda.*q22.*q33+mu.*q23.*q32);nl1.*t75+nl3.*t100+nl2.*(t51+t72+q12.*t83);zero;nl2.*(t21+t38+t80+t120+q32.*t83)+nl1.*t78+nl3.*t119;nl3.*(t21+t41+t90+t91+q13.*t94)+nl1.*t86+nl2.*t89;zero;nl1.*t97+nl2.*t100+nl3.*(t50+t72+q33.*t94);nl3.*(t101+t102+q13.*t105)+nl1.*(lambda.*q11.*q23+mu.*q13.*q21)+nl2.*(lambda.*q12.*q23+mu.*q13.*q22);zero;nl3.*(t106+t107+q33.*t105)+nl1.*(lambda.*q23.*q31+mu.*q21.*q33)+nl2.*(lambda.*q23.*q32+mu.*q22.*q33);nl1.*t110+nl2.*t113+nl3.*(t50+t72+q13.*t124);zero;nl3.*(t21+t41+t120+t121+q33.*t124)+nl1.*t116+nl2.*t119];
        end
        if nargout > 2
            fb_uh = [-t43;zero;zero;zero;-one;zero;zero;zero;-t43];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 5
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u1 = udg(:,1);
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = t21+t35;
        t37 = t9+t11+t13-1.0./2.0;
        t38 = mu.*t37.*2.0;
        t39 = t21+t38;
        t40 = t15+t17+t19-1.0./2.0;
        t41 = mu.*t40.*2.0;
        t42 = t21+t41;
        fb = [-uinf1+tau.*(u1-uh1)+nl1.*(q11.*t36+mu.*q12.*t25.*2.0+mu.*q13.*t29.*2.0)+nl2.*(q12.*t39+mu.*q11.*t25.*2.0+mu.*q13.*t33.*2.0)+nl3.*(q13.*t42+mu.*q11.*t29.*2.0+mu.*q12.*t33.*2.0);-uinf2+tau.*(u2-uh2)+nl1.*(q21.*t36+mu.*q22.*t25.*2.0+mu.*q23.*t29.*2.0)+nl2.*(q22.*t39+mu.*q21.*t25.*2.0+mu.*q23.*t33.*2.0)+nl3.*(q23.*t42+mu.*q21.*t29.*2.0+mu.*q22.*t33.*2.0);-uh3+uinf3+x3];
        if nargout > 1
            t43 = one.*tau;
            t44 = lambda.*q11;
            t45 = mu.*q11.*2.0;
            t46 = t44+t45;
            t47 = mu.*q12.*q22;
            t48 = mu.*q13.*q23;
            t49 = mu.*t25.*2.0;
            t50 = mu.*t29.*2.0;
            t51 = lambda.*q21;
            t52 = mu.*q21.*2.0;
            t53 = t51+t52;
            t54 = lambda.*q31;
            t55 = mu.*q31.*2.0;
            t56 = t54+t55;
            t57 = lambda.*q11.*q12;
            t58 = mu.*q11.*q12;
            t59 = t49+t57+t58;
            t60 = mu.*t14;
            t61 = lambda.*q12;
            t62 = mu.*q12.*2.0;
            t63 = t61+t62;
            t64 = lambda.*q12.*q21;
            t65 = mu.*q11.*q22;
            t66 = t64+t65;
            t67 = mu.*q11.*q21;
            t68 = lambda.*q11.*q22;
            t69 = mu.*q12.*q21;
            t70 = t68+t69;
            t71 = lambda.*q21.*q22;
            t72 = mu.*q21.*q22;
            t73 = t49+t71+t72;
            t74 = mu.*t33.*2.0;
            t75 = mu.*t16;
            t76 = lambda.*q22;
            t77 = mu.*q22.*2.0;
            t78 = t76+t77;
            t79 = mu.*q13.*q33;
            t80 = lambda.*q32;
            t81 = mu.*q32.*2.0;
            t82 = t80+t81;
            t83 = mu.*q23.*q33;
            t84 = lambda.*q11.*q13;
            t85 = mu.*q11.*q13;
            t86 = t50+t84+t85;
            t87 = lambda.*q12.*q13;
            t88 = mu.*q12.*q13;
            t89 = t74+t87+t88;
            t90 = mu.*t2;
            t91 = mu.*t8;
            t92 = lambda.*q13;
            t93 = mu.*q13.*2.0;
            t94 = t92+t93;
            t95 = lambda.*q13.*q21;
            t96 = mu.*q11.*q23;
            t97 = t95+t96;
            t98 = lambda.*q13.*q22;
            t99 = mu.*q12.*q23;
            t100 = t98+t99;
            t101 = lambda.*q11.*q23;
            t102 = mu.*q13.*q21;
            t103 = t101+t102;
            t104 = lambda.*q12.*q23;
            t105 = mu.*q13.*q22;
            t106 = t104+t105;
            t107 = lambda.*q21.*q23;
            t108 = mu.*q21.*q23;
            t109 = t50+t107+t108;
            t110 = lambda.*q22.*q23;
            t111 = mu.*q22.*q23;
            t112 = t74+t110+t111;
            t113 = mu.*t4;
            t114 = mu.*t10;
            t115 = lambda.*q23;
            t116 = mu.*q23.*2.0;
            t117 = t115+t116;
            t118 = mu.*q11.*q31;
            t119 = mu.*q12.*q32;
            t120 = lambda.*q33;
            t121 = mu.*q33.*2.0;
            t122 = t120+t121;
            t123 = mu.*q21.*q31;
            t124 = mu.*q22.*q32;
            fb_udg = [t43;zero;zero;zero;t43;zero;zero;zero;zero;nl1.*(t21+t35+t60+t91+q11.*t46)+nl2.*t59+nl3.*t86;nl2.*t70+nl3.*t103+nl1.*(t47+t48+q21.*t46);zero;nl2.*t66+nl3.*t97+nl1.*(t47+t48+q11.*t53);nl1.*(t21+t35+t75+t114+q21.*t53)+nl2.*t73+nl3.*t109;zero;nl1.*(t79+t119+q11.*t56)+nl2.*(lambda.*q12.*q31+mu.*q11.*q32)+nl3.*(lambda.*q13.*q31+mu.*q11.*q33);nl1.*(t83+t124+q21.*t56)+nl2.*(lambda.*q22.*q31+mu.*q21.*q32)+nl3.*(lambda.*q23.*q31+mu.*q21.*q33);zero;nl2.*(t21+t38+t60+t90+q12.*t63)+nl1.*t59+nl3.*t89;nl1.*t66+nl3.*t106+nl2.*(t48+t67+q22.*t63);zero;nl1.*t70+nl3.*t100+nl2.*(t48+t67+q12.*t78);nl2.*(t21+t38+t75+t113+q22.*t78)+nl1.*t73+nl3.*t112;zero;nl2.*(t79+t118+q12.*t82)+nl1.*(lambda.*q11.*q32+mu.*q12.*q31)+nl3.*(lambda.*q13.*q32+mu.*q12.*q33);nl2.*(t83+t123+q22.*t82)+nl1.*(lambda.*q21.*q32+mu.*q22.*q31)+nl3.*(lambda.*q23.*q32+mu.*q22.*q33);zero;nl3.*(t21+t41+t90+t91+q13.*t94)+nl1.*t86+nl2.*t89;nl1.*t97+nl2.*t100+nl3.*(t47+t67+q23.*t94);zero;nl1.*t103+nl2.*t106+nl3.*(t47+t67+q13.*t117);nl3.*(t21+t41+t113+t114+q23.*t117)+nl1.*t109+nl2.*t112;zero;nl3.*(t118+t119+q13.*t122)+nl1.*(lambda.*q11.*q33+mu.*q13.*q31)+nl2.*(lambda.*q12.*q33+mu.*q13.*q32);nl3.*(t123+t124+q23.*t122)+nl1.*(lambda.*q21.*q33+mu.*q23.*q31)+nl2.*(lambda.*q22.*q33+mu.*q23.*q32);zero];
        end
        if nargout > 2
            fb_uh = [-t43;zero;zero;zero;-t43;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 6
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u3 = udg(:,3);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x2 = pg(:,2);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = mu.*q13.*q33;
        t37 = mu.*q23.*q33;
        t38 = mu.*t25.*2.0;
        t39 = lambda.*q31.*q32;
        t40 = mu.*q31.*q32;
        t41 = t38+t39+t40;
        t42 = mu.*t18;
        t43 = t9+t11+t13-1.0./2.0;
        t44 = mu.*t43.*2.0;
        t45 = mu.*q11.*q31;
        t46 = mu.*q12.*q32;
        t47 = mu.*q21.*q31;
        t48 = mu.*q22.*q32;
        t49 = mu.*t29.*2.0;
        t50 = lambda.*q31.*q33;
        t51 = mu.*q31.*q33;
        t52 = t49+t50+t51;
        t53 = mu.*t33.*2.0;
        t54 = lambda.*q32.*q33;
        t55 = mu.*q32.*q33;
        t56 = t53+t54+t55;
        t57 = mu.*t6;
        t58 = mu.*t12;
        t59 = t15+t17+t19-1.0./2.0;
        t60 = mu.*t59.*2.0;
        fb = [one.*(-uh1+uinf1+x1);-uh2+uinf2+x2;-uinf3+tau.*(u3-uh3)+nl1.*(q31.*(t21+t35)+mu.*q32.*t25.*2.0+mu.*q33.*t29.*2.0)+nl2.*(q32.*(t21+t44)+mu.*q31.*t25.*2.0+mu.*q33.*t33.*2.0)+nl3.*(q33.*(t21+t60)+mu.*q31.*t29.*2.0+mu.*q32.*t33.*2.0)];
        if nargout > 1
            t61 = one.*tau;
            fb_udg = [zero;zero;zero;zero;zero;zero;zero;zero;t61;zero;zero;nl2.*(lambda.*q11.*q32+mu.*q12.*q31)+nl3.*(lambda.*q11.*q33+mu.*q13.*q31)+nl1.*(t36+t46+q31.*(lambda.*q11+mu.*q11.*2.0));zero;zero;nl2.*(lambda.*q21.*q32+mu.*q22.*q31)+nl3.*(lambda.*q21.*q33+mu.*q23.*q31)+nl1.*(t37+t48+q31.*(lambda.*q21+mu.*q21.*2.0));zero;zero;nl2.*t41+nl3.*t52+nl1.*(t21+t35+t42+t58+q31.*(lambda.*q31+mu.*q31.*2.0));zero;zero;nl1.*(lambda.*q12.*q31+mu.*q11.*q32)+nl3.*(lambda.*q12.*q33+mu.*q13.*q32)+nl2.*(t36+t45+q32.*(lambda.*q12+mu.*q12.*2.0));zero;zero;nl1.*(lambda.*q22.*q31+mu.*q21.*q32)+nl3.*(lambda.*q22.*q33+mu.*q23.*q32)+nl2.*(t37+t47+q32.*(lambda.*q22+mu.*q22.*2.0));zero;zero;nl1.*t41+nl3.*t56+nl2.*(t21+t42+t44+t57+q32.*(lambda.*q32+mu.*q32.*2.0));zero;zero;nl1.*(lambda.*q13.*q31+mu.*q11.*q33)+nl2.*(lambda.*q13.*q32+mu.*q12.*q33)+nl3.*(t45+t46+q33.*(lambda.*q13+mu.*q13.*2.0));zero;zero;nl1.*(lambda.*q23.*q31+mu.*q21.*q33)+nl2.*(lambda.*q23.*q32+mu.*q22.*q33)+nl3.*(t47+t48+q33.*(lambda.*q23+mu.*q23.*2.0));zero;zero;nl1.*t52+nl2.*t56+nl3.*(t21+t57+t58+t60+q33.*(lambda.*q33+mu.*q33.*2.0))];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-one;zero;zero;zero;-t61];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 7
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u1 = udg(:,1);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x2 = pg(:,2);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = mu.*t25.*2.0;
        t37 = lambda.*q11.*q12;
        t38 = mu.*q11.*q12;
        t39 = t36+t37+t38;
        t40 = mu.*t14;
        t41 = t9+t11+t13-1.0./2.0;
        t42 = mu.*t41.*2.0;
        t43 = mu.*q13.*q23;
        t44 = mu.*q13.*q33;
        t45 = mu.*t29.*2.0;
        t46 = lambda.*q11.*q13;
        t47 = mu.*q11.*q13;
        t48 = t45+t46+t47;
        t49 = mu.*t33.*2.0;
        t50 = lambda.*q12.*q13;
        t51 = mu.*q12.*q13;
        t52 = t49+t50+t51;
        t53 = mu.*t2;
        t54 = mu.*t8;
        t55 = t15+t17+t19-1.0./2.0;
        t56 = mu.*t55.*2.0;
        fb = [-uinf1+tau.*(u1-uh1)+nl1.*(q11.*(t21+t35)+mu.*q12.*t25.*2.0+mu.*q13.*t29.*2.0)+nl2.*(q12.*(t21+t42)+mu.*q11.*t25.*2.0+mu.*q13.*t33.*2.0)+nl3.*(q13.*(t21+t56)+mu.*q11.*t29.*2.0+mu.*q12.*t33.*2.0);-uh2+uinf2+x2;-uh3+uinf3+x3];
        if nargout > 1
            t57 = mu.*q11.*q21;
            t58 = mu.*q12.*q22;
            t59 = mu.*q11.*q31;
            t60 = mu.*q12.*q32;
            t61 = one.*tau;
            fb_udg = [t61;zero;zero;zero;zero;zero;zero;zero;zero;nl2.*t39+nl3.*t48+nl1.*(t21+t35+t40+t54+q11.*(lambda.*q11+mu.*q11.*2.0));zero;zero;nl2.*(lambda.*q12.*q21+mu.*q11.*q22)+nl3.*(lambda.*q13.*q21+mu.*q11.*q23)+nl1.*(t43+t58+q11.*(lambda.*q21+mu.*q21.*2.0));zero;zero;nl2.*(lambda.*q12.*q31+mu.*q11.*q32)+nl3.*(lambda.*q13.*q31+mu.*q11.*q33)+nl1.*(t44+t60+q11.*(lambda.*q31+mu.*q31.*2.0));zero;zero;nl1.*t39+nl3.*t52+nl2.*(t21+t40+t42+t53+q12.*(lambda.*q12+mu.*q12.*2.0));zero;zero;nl1.*(lambda.*q11.*q22+mu.*q12.*q21)+nl3.*(lambda.*q13.*q22+mu.*q12.*q23)+nl2.*(t43+t57+q12.*(lambda.*q22+mu.*q22.*2.0));zero;zero;nl1.*(lambda.*q11.*q32+mu.*q12.*q31)+nl3.*(lambda.*q13.*q32+mu.*q12.*q33)+nl2.*(t44+t59+q12.*(lambda.*q32+mu.*q32.*2.0));zero;zero;nl1.*t48+nl2.*t52+nl3.*(t21+t53+t54+t56+q13.*(lambda.*q13+mu.*q13.*2.0));zero;zero;nl1.*(lambda.*q11.*q23+mu.*q13.*q21)+nl2.*(lambda.*q12.*q23+mu.*q13.*q22)+nl3.*(t57+t58+q13.*(lambda.*q23+mu.*q23.*2.0));zero;zero;nl1.*(lambda.*q11.*q33+mu.*q13.*q31)+nl2.*(lambda.*q12.*q33+mu.*q13.*q32)+nl3.*(t59+t60+q13.*(lambda.*q33+mu.*q33.*2.0));zero;zero];
        end
        if nargout > 2
            fb_uh = [-t61;zero;zero;zero;-one;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    case 8
        lambda = param{2};
        mu = param{1};
        nl1 = nl(:,1);
        nl2 = nl(:,2);
        nl3 = nl(:,3);
        one = ones(ng,1);
        q11 = udg(:,4);
        q12 = udg(:,7);
        q13 = udg(:,10);
        q21 = udg(:,5);
        q22 = udg(:,8);
        q23 = udg(:,11);
        q31 = udg(:,6);
        q32 = udg(:,9);
        q33 = udg(:,12);
        tau = param{3};
        u2 = udg(:,2);
        uh1 = uh(:,1);
        uh2 = uh(:,2);
        uh3 = uh(:,3);
        uinf1 = uinf(:,1);
        uinf2 = uinf(:,2);
        uinf3 = uinf(:,3);
        x1 = pg(:,1);
        x3 = pg(:,3);
        zero = zeros(ng,1);
        t2 = q11.^2;
        t3 = t2.*(1.0./2.0);
        t4 = q21.^2;
        t5 = t4.*(1.0./2.0);
        t6 = q31.^2;
        t7 = t6.*(1.0./2.0);
        t8 = q12.^2;
        t9 = t8.*(1.0./2.0);
        t10 = q22.^2;
        t11 = t10.*(1.0./2.0);
        t12 = q32.^2;
        t13 = t12.*(1.0./2.0);
        t14 = q13.^2;
        t15 = t14.*(1.0./2.0);
        t16 = q23.^2;
        t17 = t16.*(1.0./2.0);
        t18 = q33.^2;
        t19 = t18.*(1.0./2.0);
        t20 = t3+t5+t7+t9+t11+t13+t15+t17+t19-3.0./2.0;
        t21 = lambda.*t20;
        t22 = q11.*q12.*(1.0./2.0);
        t23 = q21.*q22.*(1.0./2.0);
        t24 = q31.*q32.*(1.0./2.0);
        t25 = t22+t23+t24;
        t26 = q11.*q13.*(1.0./2.0);
        t27 = q21.*q23.*(1.0./2.0);
        t28 = q31.*q33.*(1.0./2.0);
        t29 = t26+t27+t28;
        t30 = q12.*q13.*(1.0./2.0);
        t31 = q22.*q23.*(1.0./2.0);
        t32 = q32.*q33.*(1.0./2.0);
        t33 = t30+t31+t32;
        t34 = t3+t5+t7-1.0./2.0;
        t35 = mu.*t34.*2.0;
        t36 = mu.*q13.*q23;
        t37 = mu.*t25.*2.0;
        t38 = lambda.*q21.*q22;
        t39 = mu.*q21.*q22;
        t40 = t37+t38+t39;
        t41 = mu.*t16;
        t42 = t9+t11+t13-1.0./2.0;
        t43 = mu.*t42.*2.0;
        t44 = mu.*q23.*q33;
        t45 = mu.*q11.*q21;
        t46 = mu.*q12.*q22;
        t47 = mu.*t29.*2.0;
        t48 = lambda.*q21.*q23;
        t49 = mu.*q21.*q23;
        t50 = t47+t48+t49;
        t51 = mu.*t33.*2.0;
        t52 = lambda.*q22.*q23;
        t53 = mu.*q22.*q23;
        t54 = t51+t52+t53;
        t55 = mu.*t4;
        t56 = mu.*t10;
        t57 = t15+t17+t19-1.0./2.0;
        t58 = mu.*t57.*2.0;
        fb = [one.*(-uh1+uinf1+x1);-uinf2+tau.*(u2-uh2)+nl1.*(q21.*(t21+t35)+mu.*q22.*t25.*2.0+mu.*q23.*t29.*2.0)+nl2.*(q22.*(t21+t43)+mu.*q21.*t25.*2.0+mu.*q23.*t33.*2.0)+nl3.*(q23.*(t21+t58)+mu.*q21.*t29.*2.0+mu.*q22.*t33.*2.0);-uh3+uinf3+x3];
        if nargout > 1
            t59 = mu.*q21.*q31;
            t60 = mu.*q22.*q32;
            t61 = one.*tau;
            fb_udg = [zero;zero;zero;zero;t61;zero;zero;zero;zero;zero;nl2.*(lambda.*q11.*q22+mu.*q12.*q21)+nl3.*(lambda.*q11.*q23+mu.*q13.*q21)+nl1.*(t36+t46+q21.*(lambda.*q11+mu.*q11.*2.0));zero;zero;nl2.*t40+nl3.*t50+nl1.*(t21+t35+t41+t56+q21.*(lambda.*q21+mu.*q21.*2.0));zero;zero;nl2.*(lambda.*q22.*q31+mu.*q21.*q32)+nl3.*(lambda.*q23.*q31+mu.*q21.*q33)+nl1.*(t44+t60+q21.*(lambda.*q31+mu.*q31.*2.0));zero;zero;nl1.*(lambda.*q12.*q21+mu.*q11.*q22)+nl3.*(lambda.*q12.*q23+mu.*q13.*q22)+nl2.*(t36+t45+q22.*(lambda.*q12+mu.*q12.*2.0));zero;zero;nl1.*t40+nl3.*t54+nl2.*(t21+t41+t43+t55+q22.*(lambda.*q22+mu.*q22.*2.0));zero;zero;nl1.*(lambda.*q21.*q32+mu.*q22.*q31)+nl3.*(lambda.*q23.*q32+mu.*q22.*q33)+nl2.*(t44+t59+q22.*(lambda.*q32+mu.*q32.*2.0));zero;zero;nl1.*(lambda.*q13.*q21+mu.*q11.*q23)+nl2.*(lambda.*q13.*q22+mu.*q12.*q23)+nl3.*(t45+t46+q23.*(lambda.*q13+mu.*q13.*2.0));zero;zero;nl1.*t50+nl2.*t54+nl3.*(t21+t55+t56+t58+q23.*(lambda.*q23+mu.*q23.*2.0));zero;zero;nl1.*(lambda.*q21.*q33+mu.*q23.*q31)+nl2.*(lambda.*q22.*q33+mu.*q23.*q32)+nl3.*(t59+t60+q23.*(lambda.*q33+mu.*q33.*2.0));zero];
        end
        if nargout > 2
            fb_uh = [-one;zero;zero;zero;-t61;zero;zero;zero;-one];
        end
        fb = reshape(fb,ng,nch);
        fb_udg = reshape(fb_udg,ng,nch,nc);
        fb_uh = reshape(fb_uh,ng,nch,nch);
    otherwise
         error('unknown boundary type');
end
